<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="ratears blog dev.ratears.life">
    <meta name="description" content="ratears&#39;s blog">
    <meta name="author" content="ratears">
    
    <title>
        
            《Redis 核心技术与实战》Study Notes |
        
        ratears&#39;s blog
    </title>
    
<link rel="stylesheet" href="../css/style.css">

    <link rel="shortcut icon" href="https://cdn.staticaly.com/gh/ratears/image-hosting@main/blog-img-bed/image.28pe6afbup3w.webp">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/regular.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/solid.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/brands.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"ratears.github.io","root":"/","language":"en","path":"search.json"}
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066cc","logo":"https://cdn.staticaly.com/gh/ratears/image-hosting@main/blog-img-bed/image.28pe6afbup3w.webp","favicon":"https://cdn.staticaly.com/gh/ratears/image-hosting@main/blog-img-bed/image.28pe6afbup3w.webp","avatar":"https://cdn.staticaly.com/gh/ratears/image-hosting@main/blog-img-bed/image.28pe6afbup3w.webp","font_size":"16px","font_family":null,"hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"header_transparent":true,"background_img":"/images/bg.jpg","description":"独立天地间，清风洒兰雪","font_color":null,"hitokoto":false},"scroll":{"progress_bar":true,"percent":true}},"local_search":{"enable":true,"preload":true},"code_copy":{},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"side_tools":{},"pjax":{"enable":true},"lazyload":{"enable":false},"comment":{"enable":true,"use":"valine","valine":{"appid":"qabhDeoP5PwMdjG1eEotHlts-gzGzoHsz","appkey":"fVkafVmPzZAqx86MUOuPhmuE","placeholder":"😜 尽情吐槽吧~"},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.7"},"waline":{"server_url":null,"reaction":false,"version":2}},"post":{"author_label":{"enable":true,"auto":true,"custom_label_list":["Trainee","Engineer","Architect"]},"word_count":{"enable":true,"wordcount":true,"min2read":true},"img_align":"center","copyright_info":true},"version":"3.6.1"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original article title","author":"Original article author","link":"Original article link"}
  </script>
<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="atom.xml" title="ratears" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="https://cdn.staticaly.com/gh/ratears/image-hosting@main/blog-img-bed/image.28pe6afbup3w.webp">
                </a>
            
            <a class="logo-title" href="/">
               ratears&#39;s blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="../index.html"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="../archives/"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="../categories/"
                            >
                                CATEGORIES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="../tags/"
                            >
                                TAGS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="../links/"
                            >
                                LINKS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="../about/"
                            >
                                ABOUT
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="../index.html">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="../archives/">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="../categories/">CATEGORIES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="../tags/">TAGS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="../links/">LINKS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="../about/">ABOUT</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            <div class="article-title">
                <span class="title-hover-animation">《Redis 核心技术与实战》Study Notes</span>
            </div>

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="https://cdn.staticaly.com/gh/ratears/image-hosting@main/blog-img-bed/image.28pe6afbup3w.webp">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">ratears</span>
                            
                                <span class="author-label">Lv3</span>
                            
                        </div>
                        <div class="meta-info">
                            
<div class="article-meta-info">
    <span class="article-date article-meta-item">
        
            <i class="fa-regular fa-calendar-plus"></i>&nbsp;
        
        <span class="pc">2023-03-04 16:42:03</span>
        <span class="mobile">2023-03-04 16:42</span>
    </span>
    
        <span class="article-update-date article-meta-item">
        <i class="fas fa-file-pen"></i>&nbsp;
        <span class="pc">2023-03-04 16:42:03</span>
    </span>
    
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="../Categories/Database/">Database</a>&nbsp;
                    </li>
                
                    <li>
                        &gt; <a href="../Categories/Database/Redis/">Redis</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="../Tags/Redis/">Redis</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="../Tags/Cache/">Cache</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="../Tags/Database/">Database</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>4.7k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>16 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content keep-markdown-body">
                

                <h1 id="开篇词-1讲"><a href="#开篇词-1讲" class="headerlink" title="开篇词 (1讲)"></a>开篇词 (1讲)</h1><h2 id="开篇词-这样学Redis，才能技高一筹"><a href="#开篇词-这样学Redis，才能技高一筹" class="headerlink" title="开篇词 | 这样学Redis，才能技高一筹"></a>开篇词 | 这样学Redis，才能技高一筹</h2><h3 id="Redis-的坑"><a href="#Redis-的坑" class="headerlink" title="Redis 的坑"></a>Redis 的坑</h3><ul>
<li>使用 Redis 遇到的坑总的来说大致是以下四方面：<ul>
<li>CPU使用上的“坑”，例如数据结构的复杂度、跨CPU核的访问；</li>
<li>内存使用上的“坑”，例如主从同步和AOF的内存竞争；</li>
<li>存储持久化上的“坑”，例如在SSD上做快照的性能抖动；</li>
<li>网络通信上的“坑”，例如多实例时的异常网络丢包。</li>
</ul>
</li>
</ul>
<br>

<h3 id="为什么懂得了一个个技术点，却依然用不好Redis？"><a href="#为什么懂得了一个个技术点，却依然用不好Redis？" class="headerlink" title="为什么懂得了一个个技术点，却依然用不好Redis？"></a>为什么懂得了一个个技术点，却依然用不好Redis？</h3><ul>
<li>急于解决这些细微的问题，Redis 使用能力就很难得到质的提升。</li>
<li><strong>只关注零散的技术点，没有建立起一套完整的知识框架，缺乏系统观，但是，系统观其实是至关重要的。</strong>（在解决问题时，拥有了系统观，就意味着能有依据、有章法地定位和解决问题。）</li>
<li>案例分析，把Redis的长尾延迟维持在一定阈值以下：</li>
</ul>
<blockquote>
<p>首先，我对Redis的线程模型做了分析，我发现，对于单线程的Redis而言，任何阻塞性操作都会导致长尾延迟的产生。接着，我又开始寻找可能导致阻塞的关键因素，一开始想到的是网络阻塞，但随着对Redis网络框架的理解，我知道Redis网络IO使用了IO复用机制，并不会阻塞在单个客户端上。</p>
<p>再后来，我又把目光转向了键值对数据结构、持久化机制下的fork调用、主从库同步时的AOF重写，以及缓冲区溢出等多个方面。绕了一大圈子之后，这条影响长尾延迟的“证据链”才得以形成。这样一来，我也系统地掌握了影响Redis性能的关键因素路径，之后再碰到类似的问题时，我就可以轻松解决了。</p>
</blockquote>
<br>

<h3 id="高效地形成系统观？"><a href="#高效地形成系统观？" class="headerlink" title="高效地形成系统观？"></a>高效地形成系统观？</h3><ul>
<li><p>抓住主线，在自己的脑海中绘制一幅Redis全景知识图</p>
</li>
<li><p>Redis知识全景图都包括：“两大维度，三大主线</p>
</li>
</ul>
<img src="https://cdn.staticaly.com/gh/ratears/image-hosting@main/blog-img-bed/image.5ahfyy03lgw0.webp" width="90%">

<br>

<h4 id="两大维度"><a href="#两大维度" class="headerlink" title="两大维度"></a>两大维度</h4><ul>
<li><p>系统维度：</p>
<ul>
<li>了解Redis的各项关键技术的设计原理，这些能够为你判断和推理问题打下坚实的基础，而且，你还能从中掌握一些优雅的系统设计规范，例如run-to-complete模型、epoll网络模型，这些可以应用到你后续的系统开发实践中。</li>
</ul>
</li>
<li><p>应用维度</p>
<ul>
<li><strong>应用场景驱动</strong><ul>
<li>缓存和集群是Redis的两大广泛的应用场景。提到缓存场景，你肯定会想到缓存机制、缓存替换、缓存异常等一连串的问题。</li>
</ul>
</li>
<li><strong>典型案例驱动</strong><ul>
<li>只有特定的业务场景下（比如亿级访问压力场景）才会出现，并不是普遍现象。可以用“典型案例驱动”的方式学习了。我们可以重点解读一些对Redis的“三高”特性影响较大的使用案例，例如，多家大厂在万亿级访问量和万亿级数据量的情况下对Redis的深度优化，解读这些优化实践，非常有助于你透彻地理解Redis。而且，你还可以梳理一些方法论，做成Checklist，就像是一个个锦囊，之后当你遇到问题的时候，就可以随时拿出自己的“锦囊妙计”解决问题了。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="三大主线"><a href="#三大主线" class="headerlink" title="三大主线"></a>三大主线</h4><ul>
<li><strong>高性能主线</strong>，包括线程模型、数据结构、持久化、网络框架；</li>
<li><strong>高可靠主线</strong>，包括主从复制、哨兵机制；</li>
<li><strong>高可扩展主线</strong>，包括数据分片、负载均衡。</li>
</ul>
<h4 id="Redis-问题画像图"><a href="#Redis-问题画像图" class="headerlink" title="Redis 问题画像图"></a>Redis 问题画像图</h4><img src="https://cdn.staticaly.com/gh/ratears/image-hosting@main/blog-img-bed/image.79lpd8yedvw0.webp" width="100%">

<br>

<blockquote>
<p>举个例子，如果你遇到了Redis的响应变慢问题，对照着这张图，你就可以发现，这个问题和Redis的性能主线相关，而性能主线又和数据结构、异步机制、RDB、AOF重写相关。找到了影响的因素，解决起来也就很容易了。</p>
</blockquote>
<blockquote>
<p>在学习和使用的过程中，你完全可以根据你自己的方式，完善这张画像图，把你自己实践或掌握到的新知识点，按照“问题 –&gt; 主线 –&gt; 技术点”的方式梳理出来，放到这张图上。这样一来，你的积累越来越多，画像也会越来越丰富。以后在遇到问题的时候，就很容易解决了。</p>
</blockquote>
<br>

<h3 id="课程是如何设计的？"><a href="#课程是如何设计的？" class="headerlink" title="课程是如何设计的？"></a>课程是如何设计的？</h3><ul>
<li><strong>基础篇：打破技术点之间的壁垒，带你建立网状知识结构</strong><ul>
<li>具体讲解数据结构、线程模型、持久化等</li>
</ul>
</li>
</ul>
<ul>
<li><strong>实践篇：场景和案例驱动，取人之长，梳理出一套属于你自己的“武林秘籍”</strong><ul>
<li>“案例”层面：介绍数据结构的合理使用、避免请求阻塞和抖动、避免内存竞争和提升内存使用效率</li>
<li>“场景”层面：<ul>
<li>缓存场景：重点讲解缓存基本原理及淘汰策略，还有雪崩、穿透、污染等异常情况</li>
<li>集群场景：围绕集群方案优化、数据一致性、高并发访问等问题，聊聊可行的解决方案。</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>未来篇：具有前瞻性，解锁新特性</strong><ul>
<li>Redis6 新特性</li>
<li>以及当前业界对Redis的最新探索，这会让你拥有前瞻性视角，了解Redis的发展路线图，为未来的发展提前做好准备。</li>
</ul>
</li>
</ul>
<br>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>Redis是一个非常优秀的系统，它在CPU使用、内存组织、存储持久化和网络通信这四大方面的设计非常经典，而这些，基本涵盖了一个优秀的后端系统工程师需要掌握的核心知识和关键技术。希望你通过这个课程的学习，成长为一名优秀的系统工程师。</li>
</ul>
<br>

<br>

<br>

<h1 id="基础篇-10讲"><a href="#基础篇-10讲" class="headerlink" title="基础篇 (10讲)"></a>基础篇 (10讲)</h1><h2 id="01-基本架构：一个键值数据库包含什么？"><a href="#01-基本架构：一个键值数据库包含什么？" class="headerlink" title="01 | 基本架构：一个键值数据库包含什么？"></a>01 | 基本架构：一个键值数据库包含什么？</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ul>
<li>更好的学习方式就是先建立起“<strong>系统观</strong>”：想要深入理解和优化Redis，就必须要对它的总体架构和关键模块有一个全局的认知，然后再深入到具体的技术点。</li>
<li>经过这样一个过程，我们在实践中定位和解决问题时，就会轻松很多，而且你还可以把这个学习方式迁移到其他的学习活动上。彻底掌握这个学习思路，让自己的学习、工作效率更高。</li>
</ul>
<h3 id="构造简单的键值数据库-SimpleKV"><a href="#构造简单的键值数据库-SimpleKV" class="headerlink" title="构造简单的键值数据库 SimpleKV"></a>构造简单的键值数据库 SimpleKV</h3><ul>
<li>我们只需要关注整体架构和核心模块。我们通过剖析这个最简单的键值数据库，来迅速抓住学习和调优Redis的关键。</li>
<li>开始构造SimpleKV时，首先就要考虑里面可以存什么样的数据，对数据可以做什么样的操作，也就是数据模型和操作接口。</li>
<li>才能明白 Redis，它到底能做什么，不能做什么呢？只有先搞懂它的数据模型和操作接口，我们才能真正把“这块好钢用在刀刃上”。</li>
</ul>
<h3 id="可以存哪些数据？"><a href="#可以存哪些数据？" class="headerlink" title="可以存哪些数据？"></a>可以存哪些数据？</h3><ul>
<li>在对键值数据库进行选型时，一个重要的考虑因素是<strong>它支持的value类型</strong>。（例如，Memcached支持的value类型仅为String类型，而Redis支持的value类型包括了String、哈希表、列表、集合等。<strong>Redis能够在实际业务场景中得到广泛的应用，就是得益于支持多样化类型的value</strong>。）</li>
<li>从使用的角度来说，不同value类型的实现，不仅可以支撑不同业务的数据需求，而且也隐含着不同数据结构在性能、空间效率等方面的差异，从而导致不同的value操作之间存在着差异。</li>
<li>对于键值数据库而言，基本的数据模型是key-value模型</li>
<li>在SimpleKV中，key是String类型，而value是基本数据类型</li>
<li>从使用的角度来说，不同value类型的实现，不仅可以支撑不同业务的数据需求，而且也隐含着不同数据结构在性能、空间效率等方面的差异，从而导致不同的value操作之间存在着差异。</li>
<li><strong>理解了这背后的原理，我们才能在选择Redis value类型和优化Redis性能时，做到游刃有余。</strong></li>
</ul>
<h3 id="可以对数据做什么操作？"><a href="#可以对数据做什么操作？" class="headerlink" title="可以对数据做什么操作？"></a>可以对数据做什么操作？</h3><ul>
<li><p>SimpleKV需要支持的3种基本操作</p>
<ul>
<li>PUT：新写入或更新一个key-value对；</li>
<li>GET：根据一个key读取相应的value值；</li>
<li>DELETE：根据一个key删除整个key-value对。</li>
</ul>
</li>
<li><p><strong>有些键值数据库的新写/更新操作叫SET</strong>。新写入和更新虽然是用一个操作接口，但在实际执行时，会根据key是否存在而执行相应的新写或更新流程。</p>
</li>
<li><p><strong>根据一段key的范围返回相应的value值</strong>。因此，<strong>PUT/GET/DELETE/SCAN是一个键值数据库的基本操作集合</strong>。</p>
</li>
<li><p>实际业务场景通常还有更加丰富的需求（可以增加EXISTS操作接口，用于判断某个key是否存在）</p>
</li>
<li><p>当一个键值数据库的value类型多样化时，就需要包含相应的操作接口。（Redis的value有列表类型，因此它的接口就要包括对列表value的操作）</p>
</li>
</ul>
<h3 id="键值对保存在内存还是外存？"><a href="#键值对保存在内存还是外存？" class="headerlink" title="键值对保存在内存还是外存？"></a><strong>键值对保存在内存还是外存？</strong></h3><table>
<thead>
<tr>
<th align="center">-</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td align="center">保存在内存</td>
<td>读写快，内存的访问速度一般都在百ns级别</td>
<td>潜在的风险是一旦掉电，所有的数据都会丢失。</td>
</tr>
<tr>
<td align="center">保存在外存</td>
<td>避免数据丢失</td>
<td>限于磁盘的慢速读写（通常在几ms级别），键值数据库的整体性能会被拉低。</td>
</tr>
</tbody></table>
<ul>
<li><strong>如何进行设计选择，我们通常需要考虑键值数据库的主要应用场景</strong>。</li>
<li>缓存场景下的数据需要能快速访问但允许丢失，那么，用于此场景的键值数据库通常采用内存保存键值数据。</li>
</ul>
<ul>
<li>SimpleKV就采用内存保存键值数据。</li>
<li>SimpleKV的基本组件（大体来说，一个键值数据库包括了<strong>访问框架、索引模块、操作模块和存储模块</strong>四部分）</li>
</ul>
<img src="https://cdn.staticaly.com/gh/ratears/image-hosting@main/blog-img-bed/1677935790805.4uoprcbmpy80.webp" width="70%">

<br>

<h3 id="采用什么访问模式？"><a href="#采用什么访问模式？" class="headerlink" title="采用什么访问模式？"></a>采用什么访问模式？</h3><h4 id="常用的两种访问模式"><a href="#常用的两种访问模式" class="headerlink" title="常用的两种访问模式"></a>常用的两种访问模式</h4><ul>
<li>（1）<strong>通过函数库调用的方式供外部应用使用</strong>，比如，上图中的libsimplekv.so，就是以动态链接库的形式链接到我们自己的程序中，提供键值存储功能；</li>
<li>（2）<strong>通过网络框架以Socket通信的形式对外提供键值对操作</strong>，这种形式可以提供广泛的键值存储服务。在上图中，我们可以看到，网络框架中包括Socket Server和协议解析。</li>
</ul>
<blockquote>
<p>不同的键值数据库服务器和客户端交互的协议并不相同，我们在对键值数据库进行二次开发、新增功能时，必须要了解和掌握键值数据库的通信协议，这样才能开发出兼容的客户端。</p>
</blockquote>
<blockquote>
<p>实际的键值数据库也基本采用上述两种方式，例如，RocksDB以动态链接库的形式使用，而Memcached和Redis则是通过网络框架访问。</p>
</blockquote>
<h4 id="I-O模型设计"><a href="#I-O模型设计" class="headerlink" title="I/O模型设计"></a>I/O模型设计</h4><ul>
<li>通过网络框架提供键值存储服务，一方面扩大了键值数据库的受用面，但另一方面，也给键值数据库的性能、运行模型提供了不同的设计选择，带来了一些潜在的问题。</li>
<li>举个例子，当客户端发送一个如下的命令后，该命令会被封装在网络包中发送给键值数据库：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT &quot;hello&quot; &quot;world&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>键值数据库网络框架接收到网络包，并按照相应的协议进行解析之后，就可以知道，客户端想写入一个键值对，并开始实际的写入流程。此时，我们会遇到一个系统设计上的问题，简单来说，就是网络连接的处理、网络请求的解析，以及数据存取的处理，是用一个线程、多个线程，还是多个进程来交互处理呢？该如何进行设计和取舍呢？我们一般把这个问题称为I/O模型设计。不同的I/O模型对键值数据库的性能和可扩展性会有不同的影响。</li>
<li>举个例子，如果一个线程既要处理网络连接、解析请求，又要完成数据存取，一旦某一步操作发生阻塞，整个线程就会阻塞住，这就降低了系统响应速度。如果我们采用不同线程处理不同操作，那么，某个线程被阻塞时，其他线程还能正常运行。但是，不同线程间如果需要访问共享资源，那又会产生线程竞争，也会影响系统效率，这又该怎么办呢？所以，这的确是个“两难”选择，需要我们进行精心的设计。</li>
<li><strong>经常听说Redis是单线程，那么，Redis又是如何做到“单线程，高性能”的呢？</strong></li>
</ul>
<br>

<h3 id="如何定位键值对的位置？"><a href="#如何定位键值对的位置？" class="headerlink" title="如何定位键值对的位置？"></a>如何定位键值对的位置？</h3><ul>
<li>SimpleKV 需要查找所要操作的键值对是否存在，这依赖于键值数据库的索引模块。<strong>索引的作用是让键值数据库根据key找到相应value的存储位置，进而执行操作</strong>。</li>
<li>索引的类型有很多：常见的有哈希表、B+树、字典树等</li>
<li>Memcached和Redis采用哈希表作为key-value索引，而RocksDB则采用跳表作为内存中key-value的索引。</li>
<li>一般而言，内存键值数据库（例如Redis）采用哈希表作为索引：原因在于，其键值数据基本都是保存在内存中的，而内存的高性能随机访问特性可以很好地与哈希表O(1)的操作复杂度相匹配。</li>
<li>SimpleKV的索引根据key找到value的存储位置即可。</li>
<li>对于Redis而言，它的value支持多种类型，当我们通过索引找到一个key所对应的value后，仍然需要从value的复杂结构（例如集合和列表）中进一步找到我们实际需要的数据，这个操作的效率本身就依赖于它们的实现结构。</li>
<li>Redis采用一些常见的高效索引结构作为某些value类型的底层数据结构，这一技术路线为Redis实现高性能访问提供了良好的支撑。</li>
</ul>
<h3 id="不同操作的具体逻辑是怎样的？"><a href="#不同操作的具体逻辑是怎样的？" class="headerlink" title="不同操作的具体逻辑是怎样的？"></a>不同操作的具体逻辑是怎样的？</h3><ul>
<li>SimpleKV的操作模块就实现了不同操作的具体逻辑：<ul>
<li>对于GET/SCAN操作而言，此时根据value的存储位置返回value值即可；</li>
<li>对于PUT一个新的键值对数据而言，SimpleKV需要为该键值对分配内存空间；</li>
<li>对于DELETE操作，SimpleKV需要删除键值对，并释放相应的内存空间，这个过程由分配器完成。</li>
</ul>
</li>
</ul>
<h3 id="如何实现重启后快速提供服务？"><a href="#如何实现重启后快速提供服务？" class="headerlink" title="如何实现重启后快速提供服务？"></a>如何实现重启后快速提供服务？</h3><ul>
<li>SimpleKV采用了常用的内存分配器glibc的malloc和free，因此，SimpleKV并不需要特别考虑内存空间的管理问题。<ul>
<li>键值数据库的键值对通常大小不一，glibc的分配器在处理随机的大小内存块分配时，表现并不好。一旦保存的键值对数据规模过大，就可能会造成较严重的内存碎片问题。</li>
<li>分配器是键值数据库中的一个关键因素。对于以内存存储为主的Redis而言，这点尤为重要。Redis的内存分配器提供了多种选择，分配效率也不一样</li>
</ul>
</li>
<li>SimpleKV重启后能快速重新提供服务，所以，在SimpleKV的存储模块中增加了持久化功能。</li>
<li>鉴于磁盘管理要比内存管理复杂，SimpleKV就直接采用了文件形式，将键值数据通过调用本地文件系统的操作接口保存在磁盘上。</li>
<li>SimpleKV只需要考虑何时将内存中的键值数据保存到文件中<ul>
<li>对于每一个键值对，SimpleKV都对其进行落盘保存（数据更加安全可靠，但性能受影响）</li>
<li>SimpleKV只是周期性地把内存中的键值数据保存到文件中（避免写盘操作的性能影响，潜在代价是数据有丢失风险）</li>
</ul>
</li>
</ul>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><img src="https://cdn.staticaly.com/gh/ratears/image-hosting@main/blog-img-bed/1677950601417.5vtydx0t9540.webp" width="90%">

<br>

<ul>
<li>从SimpleKV演进到Redis，有以下几个重要变化：<ul>
<li>Redis主要通过网络框架进行访问，而不再是动态库了，这也使得Redis可以作为一个基础性的网络服务进行访问，扩大了Redis的应用范围。</li>
<li>Redis数据模型中的value类型很丰富，因此也带来了更多的操作接口，例如面向列表的LPUSH/LPOP，面向集合的SADD/SREM等。</li>
<li>Redis的持久化模块能支持两种方式：日志（AOF）和快照（RDB），这两种持久化方式具有不同的优劣势，影响到Redis的访问性能和可靠性。</li>
<li>SimpleKV是个简单的单机键值数据库，但是，Redis支持高可靠集群和高可扩展集群，因此，Redis中包含了相应的集群功能支撑模块。</li>
</ul>
</li>
</ul>
<br>

<br>

<br>

<h2 id="02-数据结构：快速的Redis有哪些慢操作？"><a href="#02-数据结构：快速的Redis有哪些慢操作？" class="headerlink" title="02 | 数据结构：快速的Redis有哪些慢操作？"></a>02 | 数据结构：快速的Redis有哪些慢操作？</h2><h3 id="Redis为什么这么快，快在哪里呢？"><a href="#Redis为什么这么快，快在哪里呢？" class="headerlink" title="Redis为什么这么快，快在哪里呢？"></a>Redis为什么这么快，快在哪里呢？</h3><ul>
<li>一个重要的表现：它接收到一个键值对操作后，能以<strong>微秒级别</strong>的速度找到数据，并快速完成操作。</li>
<li>它是内存数据库，所有操作都在内存上完成，内存的访问速度本身就很快。</li>
<li>Redis的 键值对是按一定的数据结构来组织的，操作键值对最终就是对数据结构进行增删改查操作，所以高效的数据结构是Redis快速处理数据的基础。</li>
<li>底层数据结构一共有6种，分别是简单动态字符串、双向链表、压缩列表、哈希表、跳表和整数数组。</li>
</ul>
<img src="https://cdn.staticaly.com/gh/ratears/image-hosting@main/blog-img-bed/25c03cf39c78c8cb1789242cd98ae23.2i3m8lnoiya0.webp" width="100%">

<br>

<ul>
<li>有些问题已经值得我们去考虑了：<ul>
<li>这些数据结构都是值的底层实现，键和值本身之间用什么结构组织？</li>
<li>为什么集合类型有那么多的底层结构，它们都是怎么组织数据的，都很快吗？</li>
<li>什么是简单动态字符串，和常用的字符串是一回事吗？</li>
</ul>
</li>
</ul>
<h3 id="键和值用什么结构组织？"><a href="#键和值用什么结构组织？" class="headerlink" title="键和值用什么结构组织？"></a>键和值用什么结构组织？</h3><br>

<br>

<br>

<h2 id="03-高性能IO模型：为什么单线程Redis能那么快？"><a href="#03-高性能IO模型：为什么单线程Redis能那么快？" class="headerlink" title="03 | 高性能IO模型：为什么单线程Redis能那么快？"></a>03 | 高性能IO模型：为什么单线程Redis能那么快？</h2><br>

<br>

<br>

<h1 id="学习备注"><a href="#学习备注" class="headerlink" title="学习备注"></a>学习备注</h1><blockquote>
<p>1</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">red</span>&gt;</span><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;emsp;</span><span class="symbol">&amp;emsp;</span></span><br></pre></td></tr></table></figure>

<img src="" width="100%">

<br>
            </div>

            
                <div class="post-copyright-info">
                    
<div class="article-copyright-info-container">
    <ul class="copyright-info-content">
        <li class="post-title">
            <span class="type">Post title</span>: <span class="content">《Redis 核心技术与实战》Study Notes</span>
        </li>
        <li class="post-author">
            <span class="type">Post author</span>: <span class="content">ratears</span>
        </li>
        <li class="post-time">
            <span class="type">Create time</span>: <span class="content">2023-03-04 16:42:03</span>
        </li>
        <li class="post-link">
            <span class="type">Post link</span>: <span class="content">《Redis-核心技术与实战》Study-Notes/</span>
        </li>
        <li class="post-license">
            <span class="type">Copyright notice</span>: <span class="content">All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.</span>
        </li>
    </ul>
    <div class="copy-copyright-info flex-center tooltip" data-content="Copy copyright info" data-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="../Tags/Redis/">#Redis</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="../Tags/Cache/">#Cache</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="../Tags/Database/">#Database</a>&nbsp;
                        </li>
                    
                </ul>
            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                               rel="prev"
                               href="../%E3%80%8AKafka%E5%A4%9A%E7%BB%B4%E5%BA%A6%E7%B3%BB%E7%BB%9F%E7%B2%BE%E8%AE%B2%EF%BC%8C%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E3%80%8BStudy-Notes/"
                            >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                                <span class="title flex-center">
                                <span class="post-nav-title-item">《Kafka多维度系统精讲，从入门到实战开发》Study Notes</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                               rel="next"
                               href="../Mybatis-Study-Notes%EF%BC%881%EF%BC%89%EF%BC%9AMybatis-Introduction/"
                            >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Mybatis Study Notes（1）：Mybatis Introduction</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                                <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                            </a>
                        </div>
                    
                </div>
            

            
                <div class="comment-container">
                    
<div class="comments-container">
    <div id="comments-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments"></i>&nbsp;Comments
    </div>
    
        
            

    <div class="valine-container">
        <script data-pjax src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
          function loadValine() {

            const config = {
              el: '#vcomments',
              appId: 'qabhDeoP5PwMdjG1eEotHlts-gzGzoHsz',
              appKey: 'fVkafVmPzZAqx86MUOuPhmuE',
              meta: ['nick', 'mail', 'link'],
              avatar: 'wavatar',
              enableQQ: true,
              placeholder: '😜 尽情吐槽吧~',
              lang: 'en'.toLowerCase()
            }

            if ('') {
              config.serverURLs = ''
            }

            new Valine(config)

            function getAuthor(language) {
              switch (language) {
                case 'en':
                  return 'Author'
                case 'zh-CN':
                  return '博主'
                default:
                  return 'Master'
              }
            }

            // Add "Author" identify
            const getValineDomTimer = setInterval(() => {
              const vcards = document.querySelectorAll('#vcomments .vcards .vcard')
              if (vcards.length > 0) {
                let author = 'ratears'

                if (author) {
                  for (let vcard of vcards) {
                    const vnick_dom = vcard.querySelector('.vhead .vnick')
                    const vnick = vnick_dom.innerHTML
                    if (vnick === author) {
                      vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                    }
                  }
                }
                clearInterval(getValineDomTimer)
              } else {
                clearInterval(getValineDomTimer)
              }
            }, 2000)
          }

          if ('true' === 'true') {
            const loadValineTimeout = setTimeout(() => {
              loadValine()
              clearTimeout(loadValineTimeout)
            }, 1000)
          } else {
            window.addEventListener('DOMContentLoaded', loadValine)
          }
        </script>
    </div>



        
    
</div>

                </div>
            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%80%E7%AF%87%E8%AF%8D-1%E8%AE%B2"><span class="nav-number">1.</span> <span class="nav-text">开篇词 (1讲)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E7%AF%87%E8%AF%8D-%E8%BF%99%E6%A0%B7%E5%AD%A6Redis%EF%BC%8C%E6%89%8D%E8%83%BD%E6%8A%80%E9%AB%98%E4%B8%80%E7%AD%B9"><span class="nav-number">1.1.</span> <span class="nav-text">开篇词 | 这样学Redis，才能技高一筹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis-%E7%9A%84%E5%9D%91"><span class="nav-number">1.1.1.</span> <span class="nav-text">Redis 的坑</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%87%82%E5%BE%97%E4%BA%86%E4%B8%80%E4%B8%AA%E4%B8%AA%E6%8A%80%E6%9C%AF%E7%82%B9%EF%BC%8C%E5%8D%B4%E4%BE%9D%E7%84%B6%E7%94%A8%E4%B8%8D%E5%A5%BDRedis%EF%BC%9F"><span class="nav-number">1.1.2.</span> <span class="nav-text">为什么懂得了一个个技术点，却依然用不好Redis？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E6%95%88%E5%9C%B0%E5%BD%A2%E6%88%90%E7%B3%BB%E7%BB%9F%E8%A7%82%EF%BC%9F"><span class="nav-number">1.1.3.</span> <span class="nav-text">高效地形成系统观？</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%A4%E5%A4%A7%E7%BB%B4%E5%BA%A6"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">两大维度</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%89%E5%A4%A7%E4%B8%BB%E7%BA%BF"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">三大主线</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Redis-%E9%97%AE%E9%A2%98%E7%94%BB%E5%83%8F%E5%9B%BE"><span class="nav-number">1.1.3.3.</span> <span class="nav-text">Redis 问题画像图</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BE%E7%A8%8B%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E7%9A%84%EF%BC%9F"><span class="nav-number">1.1.4.</span> <span class="nav-text">课程是如何设计的？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">1.1.5.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%AF%87-10%E8%AE%B2"><span class="nav-number">2.</span> <span class="nav-text">基础篇 (10讲)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#01-%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%B8%80%E4%B8%AA%E9%94%AE%E5%80%BC%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8C%85%E5%90%AB%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="nav-number">2.1.</span> <span class="nav-text">01 | 基本架构：一个键值数据库包含什么？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">2.1.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E9%80%A0%E7%AE%80%E5%8D%95%E7%9A%84%E9%94%AE%E5%80%BC%E6%95%B0%E6%8D%AE%E5%BA%93-SimpleKV"><span class="nav-number">2.1.2.</span> <span class="nav-text">构造简单的键值数据库 SimpleKV</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E4%BB%A5%E5%AD%98%E5%93%AA%E4%BA%9B%E6%95%B0%E6%8D%AE%EF%BC%9F"><span class="nav-number">2.1.3.</span> <span class="nav-text">可以存哪些数据？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E4%BB%A5%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%81%9A%E4%BB%80%E4%B9%88%E6%93%8D%E4%BD%9C%EF%BC%9F"><span class="nav-number">2.1.4.</span> <span class="nav-text">可以对数据做什么操作？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%AE%E5%80%BC%E5%AF%B9%E4%BF%9D%E5%AD%98%E5%9C%A8%E5%86%85%E5%AD%98%E8%BF%98%E6%98%AF%E5%A4%96%E5%AD%98%EF%BC%9F"><span class="nav-number">2.1.5.</span> <span class="nav-text">键值对保存在内存还是外存？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%87%E7%94%A8%E4%BB%80%E4%B9%88%E8%AE%BF%E9%97%AE%E6%A8%A1%E5%BC%8F%EF%BC%9F"><span class="nav-number">2.1.6.</span> <span class="nav-text">采用什么访问模式？</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E4%B8%A4%E7%A7%8D%E8%AE%BF%E9%97%AE%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.1.6.1.</span> <span class="nav-text">常用的两种访问模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#I-O%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1"><span class="nav-number">2.1.6.2.</span> <span class="nav-text">I&#x2F;O模型设计</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%AE%9A%E4%BD%8D%E9%94%AE%E5%80%BC%E5%AF%B9%E7%9A%84%E4%BD%8D%E7%BD%AE%EF%BC%9F"><span class="nav-number">2.1.7.</span> <span class="nav-text">如何定位键值对的位置？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E6%93%8D%E4%BD%9C%E7%9A%84%E5%85%B7%E4%BD%93%E9%80%BB%E8%BE%91%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84%EF%BC%9F"><span class="nav-number">2.1.8.</span> <span class="nav-text">不同操作的具体逻辑是怎样的？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E9%87%8D%E5%90%AF%E5%90%8E%E5%BF%AB%E9%80%9F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8A%A1%EF%BC%9F"><span class="nav-number">2.1.9.</span> <span class="nav-text">如何实现重启后快速提供服务？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">2.1.10.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#02-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E5%BF%AB%E9%80%9F%E7%9A%84Redis%E6%9C%89%E5%93%AA%E4%BA%9B%E6%85%A2%E6%93%8D%E4%BD%9C%EF%BC%9F"><span class="nav-number">2.2.</span> <span class="nav-text">02 | 数据结构：快速的Redis有哪些慢操作？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%99%E4%B9%88%E5%BF%AB%EF%BC%8C%E5%BF%AB%E5%9C%A8%E5%93%AA%E9%87%8C%E5%91%A2%EF%BC%9F"><span class="nav-number">2.2.1.</span> <span class="nav-text">Redis为什么这么快，快在哪里呢？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%AE%E5%92%8C%E5%80%BC%E7%94%A8%E4%BB%80%E4%B9%88%E7%BB%93%E6%9E%84%E7%BB%84%E7%BB%87%EF%BC%9F"><span class="nav-number">2.2.2.</span> <span class="nav-text">键和值用什么结构组织？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#03-%E9%AB%98%E6%80%A7%E8%83%BDIO%E6%A8%A1%E5%9E%8B%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8D%95%E7%BA%BF%E7%A8%8BRedis%E8%83%BD%E9%82%A3%E4%B9%88%E5%BF%AB%EF%BC%9F"><span class="nav-number">2.3.</span> <span class="nav-text">03 | 高性能IO模型：为什么单线程Redis能那么快？</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E5%A4%87%E6%B3%A8"><span class="nav-number">3.</span> <span class="nav-text">学习备注</span></a></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            
<footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
                <span>2018</span> -
            
            2023
            
                &nbsp;<i class="fas fa-heart icon-animate"></i>
                &nbsp;<a href="/">ratears</a>
            
        </div>
        
            <script async data-pjax
                    src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                
                
                    Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.6.1</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="tools-item flex-center go-to-comments">
                <i class="fas fa-comment"></i>
                <span class="post-comments-count"></span>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/dark-light-toggle.js"></script>




    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/code-block.js"></script>




<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/post-helper.js"></script>
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/libs/anime.min.js"></script>
        
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/toc.js"></script>
        
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
